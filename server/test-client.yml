version: '3.5'

services:

    tailscale:
        image: tailscale/tailscale:latest
        expose:
            - "8000"
        volumes:
            - "./tailscale/var_lib:/var/lib"        # State data will be stored in this directory
            - "/dev/net/tun:/dev/net/tun"           # Required for tailscale to work 
        cap_add:                                               # Required for tailscale to work
            - net_admin
            - sys_module
        command: tailscaled
        environment:
            - TS_EXTRA_ARGS=--login-server=http://dibbler:9080
            
        restart: unless-stopped
      
    # 1cd50ab45eb69c9c5cccba50f58fa14e7261e6e345d72cbd
    # tailscale up --login-server http://headscale.mydomain.com --authkey 3215a1ce7967c11e8ea844b3e199d3c46f9f5e7b660b48fb
    signal:
        image: jwilder/whoami
        network_mode: "service:tailscale"
        environment:
            - VIRTUAL_HOST=tart.api
            - VIRTUAL_PORT=8000
            - VIRTUAL_PATH=/signal
        
